import{c as B,j as e,d as V}from"./ui-vendor-D2IXE4bY.js";import{r as p}from"./react-vendor-XYDEKuIS.js";import{g as H,i as K,u as X,j as y,n as Q,C as _,b,c as A,d as O,e as P,B as L,L as C,f as u,s as T}from"./index-0hnW3E_C.js";import{L as g,I as N}from"./label-DZSOZ5Rh.js";import{S as J,a as Y,b as Z,c as ee,d as se,T as re}from"./textarea-VNbvqAuD.js";import{F,a as ae}from"./constants-5iGU4EYx.js";import{A as te,C as ne,b as ie,r as le,f as oe}from"./alert-CISo7n8J.js";import{S as R}from"./skeleton-DucBJ-c_.js";import{S as ce}from"./save-CAQ3HTEe.js";import"./supabase-vendor-DBhEyip2.js";import"./chart-vendor-CZvqwiTC.js";import"./types-rH0z_lOS.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=H("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);var E="Progress",I=100,[ue,Le]=B(E),[me,pe]=ue(E),D=p.forwardRef((s,a)=>{const{__scopeProgress:c,value:o=null,max:t,getValueLabel:x=ge,...n}=s;(t||t===0)&&!S(t)&&console.error(xe(`${t}`,"Progress"));const l=S(t)?t:I;o!==null&&!w(o,l)&&console.error(he(`${o}`,"Progress"));const d=w(o,l)?o:null,h=j(d)?x(d,l):void 0;return e.jsx(me,{scope:c,value:d,max:l,children:e.jsx(V.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":j(d)?d:void 0,"aria-valuetext":h,role:"progressbar","data-state":z(d,l),"data-value":d??void 0,"data-max":l,...n,ref:a})})});D.displayName=E;var U="ProgressIndicator",G=p.forwardRef((s,a)=>{const{__scopeProgress:c,...o}=s,t=pe(U,c);return e.jsx(V.div,{"data-state":z(t.value,t.max),"data-value":t.value??void 0,"data-max":t.max,...o,ref:a})});G.displayName=U;function ge(s,a){return`${Math.round(s/a*100)}%`}function z(s,a){return s==null?"indeterminate":s===a?"complete":"loading"}function j(s){return typeof s=="number"}function S(s){return j(s)&&!isNaN(s)&&s>0}function w(s,a){return j(s)&&!isNaN(s)&&s<=a&&s>=0}function xe(s,a){return`Invalid prop \`max\` of value \`${s}\` supplied to \`${a}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${I}\`.`}function he(s,a){return`Invalid prop \`value\` of value \`${s}\` supplied to \`${a}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${I} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var k=D,fe=G;const $=p.forwardRef(({className:s,value:a,...c},o)=>e.jsx(k,{ref:o,className:K("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...c,children:e.jsx(fe,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})}));$.displayName=k.displayName;const m={AUTH_REQUIRED:"Vous devez être connecté pour effectuer cette action",AUTH_FAILED:"Échec de l'authentification. Vérifiez vos identifiants.",SESSION_EXPIRED:"Votre session a expiré. Veuillez vous reconnecter.",PASSWORD_COMPROMISED:"Ce mot de passe a été compromis dans une fuite de données. Veuillez en choisir un autre.",PASSWORD_WEAK:"Le mot de passe ne respecte pas les critères de sécurité requis.",PIG_LOAD_ERROR:"Erreur lors du chargement des porcs",PIG_ADD_ERROR:"Erreur lors de l'ajout du porc",PIG_UPDATE_ERROR:"Erreur lors de la mise à jour du porc",PIG_DELETE_ERROR:"Erreur lors de la suppression du porc",PIG_NOT_FOUND:"Porc introuvable",PIG_VALIDATION_ERROR:"Les données du porc sont invalides",FORMULATION_GENERATE_ERROR:"Erreur lors de la génération de la formulation",FORMULATION_SAVE_ERROR:"Erreur lors de la sauvegarde de la formulation",FORMULATION_LIMIT_REACHED:"Limite de formulations atteinte. Passez en Premium pour continuer.",FORMULATION_VALIDATION_ERROR:"Les paramètres de formulation sont invalides",API_ERROR:"Erreur lors de la communication avec le serveur",API_TIMEOUT:"La requête a pris trop de temps. Veuillez réessayer.",API_RATE_LIMIT:"Trop de requêtes. Veuillez patienter quelques instants.",FILE_TOO_LARGE:"Le fichier est trop volumineux. Taille maximale: 5MB",FILE_INVALID_TYPE:"Type de fichier non supporté. Utilisez JPG, PNG ou WebP",FILE_UPLOAD_ERROR:"Erreur lors du téléchargement du fichier",NETWORK_ERROR:"Erreur de connexion. Vérifiez votre connexion internet.",UNKNOWN_ERROR:"Une erreur inattendue s'est produite",VALIDATION_ERROR:"Veuillez corriger les erreurs dans le formulaire",REQUIRED_FIELD:"Ce champ est obligatoire"};function M(s,a){return a?`${s}: ${a}`:s}function Ce(){const{user:s,profile:a}=X(),[c,o]=p.useState(!1),[t,x]=p.useState(null),[n,l]=p.useState({name:"",pigCategory:"",targetWeight:"",budget:"",availableIngredients:""}),d=(a==null?void 0:a.formulations_count)||0,h=Math.max(0,F-d),f=h===0&&(a==null?void 0:a.subscription_tier)==="free",W=async()=>{if(!le.isAllowed("formulation-generate")){u.error(m.API_RATE_LIMIT);return}const r=oe.safeParse({name:n.name,pigCategory:n.pigCategory,targetWeight:n.targetWeight,budget:n.budget,availableIngredients:n.availableIngredients});if(!r.success){const i=r.error.errors[0];u.error((i==null?void 0:i.message)||m.VALIDATION_ERROR);return}if(f){u.error(m.FORMULATION_LIMIT_REACHED);return}o(!0),x(null);try{const{data:i,error:v}=await T.functions.invoke("generate-feed-formulation",{body:{pigCategory:n.pigCategory,targetWeight:parseFloat(n.targetWeight),budget:n.budget?parseFloat(n.budget):void 0,availableIngredients:n.availableIngredients}});if(v)throw v;if(!i||!i.ingredients||!i.nutritionalValues)throw new Error("Réponse invalide du serveur");x(i),u.success("Formulation générée avec succès !")}catch(i){console.error("Error generating formulation:",i);const v=(i==null?void 0:i.message)||m.FORMULATION_GENERATE_ERROR;u.error(M(m.FORMULATION_GENERATE_ERROR,v))}finally{o(!1)}},q=async()=>{if(!(!t||!s))try{const{error:r}=await T.from("feed_formulations").insert({user_id:s.id,name:n.name||`Formule ${n.pigCategory}`,pig_category:n.pigCategory,ingredients:t.ingredients,nutritional_values:t.nutritionalValues,cost_per_kg:t.costPerKg});if(r)throw r;u.success("Formulation sauvegardée avec succès !")}catch(r){console.error("Error saving formulation:",r),u.error(M(m.FORMULATION_SAVE_ERROR,r==null?void 0:r.message))}};return e.jsxs("div",{className:"content-area space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold text-foreground flex items-center gap-2",children:[e.jsx(y,{className:"h-7 w-7 text-primary"}),"Formulateur IA"]}),e.jsx("p",{className:"text-muted-foreground",children:"Créez des formules alimentaires optimisées"})]}),e.jsxs(Q,{variant:f?"destructive":"secondary",className:"text-sm",children:[h," formulations restantes"]})]}),f&&e.jsxs(te,{variant:"destructive",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsxs(ie,{children:["Vous avez atteint la limite de ",F," formulations gratuites. Passez en Premium pour des formulations illimitées."]})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(_,{children:[e.jsxs(b,{children:[e.jsx(A,{children:"Paramètres"}),e.jsx(O,{children:"Définissez les critères de votre formule"})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"name",children:"Nom de la formule"}),e.jsx(N,{id:"name",placeholder:"Ex: Formule croissance été 2024",value:n.name,onChange:r=>l({...n,name:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"category",children:"Catégorie de porc *"}),e.jsxs(J,{value:n.pigCategory,onValueChange:r=>l({...n,pigCategory:r}),children:[e.jsx(Y,{children:e.jsx(Z,{placeholder:"Sélectionner une catégorie"})}),e.jsx(ee,{children:ae.map(r=>e.jsx(se,{value:r.value,children:r.label},r.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"weight",children:"Poids cible (kg) *"}),e.jsx(N,{id:"weight",type:"number",placeholder:"Ex: 60",value:n.targetWeight,onChange:r=>l({...n,targetWeight:r.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"budget",children:"Budget max (FCFA/kg)"}),e.jsx(N,{id:"budget",type:"number",placeholder:"Ex: 300",value:n.budget,onChange:r=>l({...n,budget:r.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"ingredients",children:"Ingrédients disponibles"}),e.jsx(re,{id:"ingredients",placeholder:"Ex: maïs, tourteau de soja, son de blé...",value:n.availableIngredients,onChange:r=>l({...n,availableIngredients:r.target.value}),rows:3})]}),e.jsx(L,{onClick:W,disabled:c||f,className:"w-full",children:c?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}),"Génération en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Générer la formule"]})})]})]}),e.jsxs(_,{children:[e.jsxs(b,{children:[e.jsx(A,{children:"Résultat"}),e.jsx(O,{children:"Formule optimisée par l'IA"})]}),e.jsx(P,{children:c?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(C,{className:"h-12 w-12 animate-spin text-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"Optimisation en cours..."})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(R,{className:"h-4 w-full"}),e.jsx(R,{className:"h-4 w-3/4"}),e.jsx(R,{className:"h-4 w-1/2"})]})]}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:"Composition"}),t.ingredients.map((r,i)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:r.name}),e.jsxs("span",{className:"font-medium",children:[r.percentage,"%"]})]}),e.jsx($,{value:r.percentage,className:"h-2"})]},i))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:"Valeurs nutritionnelles"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between p-2 bg-muted/50 rounded",children:[e.jsx("span",{children:"Protéines"}),e.jsxs("span",{className:"font-medium",children:[t.nutritionalValues.protein,"%"]})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-muted/50 rounded",children:[e.jsx("span",{children:"Énergie"}),e.jsxs("span",{className:"font-medium",children:[t.nutritionalValues.energy," kcal"]})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-muted/50 rounded",children:[e.jsx("span",{children:"Fibres"}),e.jsxs("span",{className:"font-medium",children:[t.nutritionalValues.fiber,"%"]})]}),e.jsxs("div",{className:"flex justify-between p-2 bg-muted/50 rounded",children:[e.jsx("span",{children:"Lysine"}),e.jsxs("span",{className:"font-medium",children:[t.nutritionalValues.lysine,"%"]})]})]})]}),e.jsx("div",{className:"p-4 bg-success-light rounded-xl",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-success-foreground font-medium",children:"Coût estimé"}),e.jsxs("span",{className:"text-2xl font-bold text-success-foreground",children:[t.costPerKg," FCFA/kg"]})]})}),t.recommendations&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-foreground",children:"Recommandations"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.recommendations})]}),e.jsxs(L,{onClick:q,variant:"outline",className:"w-full",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Sauvegarder la formule"]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(y,{className:"h-16 w-16 text-muted-foreground/30 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Configurez les paramètres et générez une formule"})]})})]})]})]})}export{Ce as default};
