import{j as e}from"./ui-vendor-D2IXE4bY.js";import{r as l,k as re,u as ae}from"./react-vendor-XYDEKuIS.js";import{g as $,i as E,l as ie,C as Q,n as le,e as Y,o as ce,u as ne,s as I,f as C,B as w,q as oe,X as G,L as de}from"./index-0hnW3E_C.js";import{L as S,I as L}from"./label-DZSOZ5Rh.js";import{S as P}from"./skeleton-DucBJ-c_.js";import{d as ue,A as R,a as U,b as M,C as ee,p as he,s as X,c as me}from"./alert-CISo7n8J.js";import{D as xe,a as ge,b as fe,c as je,d as ve,S as pe,F as be}from"./dialog-CysqS_ro.js";import{S as D,a as T,b as F,c as O,d as _,T as Ne}from"./textarea-VNbvqAuD.js";import{P as we}from"./constants-5iGU4EYx.js";import{b as ye,c as Z,a as _e}from"./haptic-feedback-C7ikSRXG.js";import{C as k,M as V}from"./map-pin-0Y2TFa7U.js";import{T as Ce,a as Se,b as B,c as W}from"./tabs-CDvFmIi0.js";import{u as Ee}from"./use-pull-to-refresh-DXDxZb_V.js";import{P as K}from"./plus-DXm5Jimi.js";import"./supabase-vendor-DBhEyip2.js";import"./chart-vendor-CZvqwiTC.js";import"./types-rH0z_lOS.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=$("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=$("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=$("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);function Ie({src:c,alt:s,className:u,fallback:h="ðŸ·",skeletonClassName:g,...i}){const[o,j]=l.useState(!1),[m,p]=l.useState(!1),[v,a]=l.useState(!1),t=l.useRef(null),r=l.useRef(null);l.useEffect(()=>{const y=new IntersectionObserver(n=>{n.forEach(x=>{x.isIntersecting&&(a(!0),y.disconnect())})},{rootMargin:"50px"});return r.current&&y.observe(r.current),()=>y.disconnect()},[]);const f=()=>{j(!0)},d=()=>{p(!0),j(!0)};return m&&h&&h.startsWith("ðŸ·")?e.jsx("div",{ref:r,className:E("w-full h-full flex items-center justify-center text-6xl",u),...i,children:h}):e.jsxs("div",{ref:r,className:E("relative w-full h-full",u),children:[!o&&e.jsx(P,{className:E("absolute inset-0",g)}),v&&e.jsx("img",{ref:t,src:m&&h&&!h.startsWith("ðŸ·")?h:c,alt:s,loading:"lazy",onLoad:f,onError:d,className:E("w-full h-full object-cover transition-opacity duration-300",o?"opacity-100":"opacity-0",u),...i})]})}const Le={active:{label:"Actif",variant:"default"},sold:{label:"Vendu",variant:"secondary"},deceased:{label:"DÃ©cÃ©dÃ©",variant:"destructive"},breeding:{label:"Reproduction",variant:"outline"}},Re=l.memo(function({pig:s,onClick:u}){const h=l.useMemo(()=>{var o;return((o=s.weight_history)==null?void 0:o.length)>0?s.weight_history[s.weight_history.length-1].weight:null},[s.weight_history]),g=l.useMemo(()=>Le[s.status],[s.status]),i=l.useMemo(()=>s.birth_date?ie(new Date(s.birth_date),"d MMM yyyy",{locale:ce}):null,[s.birth_date]);return e.jsxs(Q,{className:E("overflow-hidden cursor-pointer transition-all duration-200 hover:shadow-card-hover","border border-border/50"),onClick:u,children:[e.jsxs("div",{className:"aspect-square relative bg-muted",children:[s.photo_url?e.jsx(Ie,{src:s.photo_url,alt:`Porc ${s.tag_number}`,fallback:"ðŸ·",className:"w-full h-full"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-6xl",children:"ðŸ·"}),e.jsx(le,{variant:g.variant,className:"absolute top-2 right-2",children:g.label})]}),e.jsxs(Y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"font-semibold text-foreground",children:["#",s.tag_number]}),e.jsx("span",{className:"text-lg",children:s.sex==="male"?"â™‚ï¸":"â™€ï¸"})]}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[s.breed&&e.jsx("p",{children:s.breed}),i&&e.jsxs("p",{children:["NÃ© le ",i]}),h&&e.jsxs("p",{className:"font-medium text-foreground",children:[h," kg"]})]})]})]})},(c,s)=>c.pig.id===s.pig.id&&c.pig.tag_number===s.pig.tag_number&&c.pig.status===s.pig.status&&c.pig.photo_url===s.pig.photo_url&&JSON.stringify(c.pig.weight_history)===JSON.stringify(s.pig.weight_history)&&c.onClick===s.onClick);function H(c){return c?Array.isArray(c)?c.map(s=>typeof s=="object"&&s!==null&&"date"in s&&"weight"in s?{date:String(s.date),weight:Number(s.weight)}:{date:"",weight:0}).filter(s=>s.date!==""):[]:[]}function Me(c={}){const[s,u]=l.useState([]),[h,g]=l.useState(!0),{user:i}=ne(),o=l.useCallback(async()=>{if(i)try{g(!0);let a=I.from("pigs").select("*").eq("user_id",i.id).order("created_at",{ascending:!1});c.status&&(a=a.eq("status",c.status)),c.search&&(a=a.ilike("tag_number",`%${c.search}%`));const{data:t,error:r}=await a;if(r)throw r;const f=(t||[]).map(d=>({id:d.id,user_id:d.user_id,tag_number:d.tag_number,birth_date:d.birth_date,sex:d.sex,breed:d.breed,status:d.status,weight_history:H(d.weight_history),photo_url:d.photo_url,mother_id:d.mother_id,father_id:d.father_id,notes:d.notes,created_at:d.created_at,updated_at:d.updated_at}));u(f)}catch(a){console.error("Error fetching pigs:",a),C.error("Erreur lors du chargement des porcs")}finally{g(!1)}},[i,c.status,c.search]),j=l.useMemo(()=>ue(o,c.search?300:0),[o,c.search]),m=l.useCallback(async a=>{if(!i)return{error:new Error("Non authentifiÃ©")};try{const t={user_id:i.id,tag_number:a.tag_number,sex:a.sex,birth_date:a.birth_date||null,breed:a.breed||null,status:a.status||"active",weight_history:a.weight_history||[],photo_url:a.photo_url||null,notes:a.notes||null},{data:r,error:f}=await I.from("pigs").insert(t).select().single();if(f)throw f;const d={...r,sex:r.sex,status:r.status,weight_history:H(r.weight_history)};return u(y=>[d,...y]),{data:d,error:null}}catch(t){return console.error("Error adding pig:",t),C.error("Erreur lors de l'ajout du porc"),{data:null,error:t}}},[i]),p=l.useCallback(async(a,t)=>{try{const r={};t.tag_number!==void 0&&(r.tag_number=t.tag_number),t.sex!==void 0&&(r.sex=t.sex),t.birth_date!==void 0&&(r.birth_date=t.birth_date),t.breed!==void 0&&(r.breed=t.breed),t.status!==void 0&&(r.status=t.status),t.weight_history!==void 0&&(r.weight_history=t.weight_history),t.photo_url!==void 0&&(r.photo_url=t.photo_url),t.notes!==void 0&&(r.notes=t.notes);const{data:f,error:d}=await I.from("pigs").update(r).eq("id",a).select().single();if(d)throw d;const y={...f,sex:f.sex,status:f.status,weight_history:H(f.weight_history)};return u(n=>n.map(x=>x.id===a?y:x)),C.success("Porc mis Ã  jour avec succÃ¨s"),{data:y,error:null}}catch(r){return console.error("Error updating pig:",r),C.error("Erreur lors de la mise Ã  jour du porc"),{data:null,error:r}}},[]),v=l.useCallback(async a=>{try{const{error:t}=await I.from("pigs").delete().eq("id",a);if(t)throw t;return u(r=>r.filter(f=>f.id!==a)),C.success("Porc supprimÃ© avec succÃ¨s"),{error:null}}catch(t){return console.error("Error deleting pig:",t),C.error("Erreur lors de la suppression du porc"),{error:t}}},[]);return l.useEffect(()=>{c.search?j():o()},[i,c.status,c.search,o,j]),{pigs:s,loading:h,refetch:o,addPig:m,updatePig:p,deletePig:v}}function De(c={}){const{facingMode:s="environment",aspectRatio:u=16/9,width:h=1280,height:g=720}=c,[i,o]=l.useState(null),[j,m]=l.useState(!1),[p,v]=l.useState(null),[a,t]=l.useState(!1),r=l.useRef(null),f=l.useCallback(async()=>{try{return(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(N=>N.stop()),t(!0),!0}catch(x){return v(x),t(!1),!1}},[]),d=l.useCallback(async()=>{try{v(null);const x={video:{facingMode:s,aspectRatio:u,width:{ideal:h},height:{ideal:g}}},N=await navigator.mediaDevices.getUserMedia(x);o(N),m(!0),t(!0),r.current&&(r.current.srcObject=N,await r.current.play())}catch(x){const N=x;v(N),m(!1),t(!1),N.name==="NotAllowedError"||N.name==="PermissionDeniedError"?v(new Error("Permission d'accÃ¨s Ã  la camÃ©ra refusÃ©e")):N.name==="NotFoundError"||N.name==="DevicesNotFoundError"?v(new Error("Aucune camÃ©ra trouvÃ©e")):v(new Error(`Erreur d'accÃ¨s Ã  la camÃ©ra: ${N.message}`))}},[s,u,h,g]),y=l.useCallback(()=>{i&&(i.getTracks().forEach(x=>x.stop()),o(null),m(!1)),r.current&&(r.current.srcObject=null)},[i]),n=l.useCallback(()=>{if(!r.current||!j)return null;const x=r.current,N=document.createElement("canvas");N.width=x.videoWidth,N.height=x.videoHeight;const A=N.getContext("2d");return A?(A.drawImage(x,0,0),N.toDataURL("image/jpeg",.8)):null},[j]);return{stream:i,videoRef:r,isActive:j,error:p,startCamera:d,stopCamera:y,capturePhoto:n,hasPermission:a,requestPermission:f}}const Te={camera:{icon:k,title:"AccÃ¨s Ã  la camÃ©ra",description:"Autoriser l'accÃ¨s Ã  la camÃ©ra pour prendre des photos de vos porcs",permissionName:"camera"},microphone:{icon:ke,title:"AccÃ¨s au microphone",description:"Autoriser l'accÃ¨s au microphone pour enregistrer des notes vocales",permissionName:"microphone"},geolocation:{icon:V,title:"AccÃ¨s Ã  la localisation",description:"Autoriser l'accÃ¨s Ã  la localisation pour enregistrer l'emplacement de vos porcs",permissionName:"geolocation"}};function Fe({type:c,onGranted:s,onDenied:u,className:h}){const[g,i]=l.useState("prompt"),[o,j]=l.useState(!0),m=Te[c],p=m.icon;l.useEffect(()=>{v()},[c]);const v=async()=>{try{if(navigator.permissions){const t=await navigator.permissions.query({name:m.permissionName});i(t.state==="granted"?"granted":t.state==="denied"?"denied":"prompt"),t.onchange=()=>{i(t.state==="granted"?"granted":t.state==="denied"?"denied":"prompt")}}else i("prompt")}catch(t){console.error("Error checking permission:",t),i("prompt")}finally{j(!1)}},a=async()=>{try{c==="camera"?((await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(r=>r.stop()),i("granted"),s==null||s()):c==="microphone"?((await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(r=>r.stop()),i("granted"),s==null||s()):c==="geolocation"&&await new Promise((t,r)=>{navigator.geolocation.getCurrentPosition(()=>{i("granted"),s==null||s(),t()},f=>{f.code===f.PERMISSION_DENIED&&(i("denied"),u==null||u()),r(f)})})}catch(t){console.error("Error requesting permission:",t),i("denied"),u==null||u()}};return o?null:g==="granted"?e.jsxs(R,{className:E("border-success/50 bg-success/10",h),children:[e.jsx(Pe,{className:"h-4 w-4 text-success"}),e.jsx(U,{className:"text-success",children:"Permission accordÃ©e"}),e.jsxs(M,{children:["L'accÃ¨s Ã  ",m.title.toLowerCase()," a Ã©tÃ© autorisÃ©."]})]}):g==="denied"?e.jsxs(R,{variant:"destructive",className:h,children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx(U,{children:"Permission refusÃ©e"}),e.jsxs(M,{children:["Veuillez autoriser l'accÃ¨s Ã  ",m.title.toLowerCase()," dans les paramÃ¨tres de votre navigateur."]})]}):e.jsxs(R,{className:E("border-primary/50 bg-primary/5",h),children:[e.jsx(p,{className:"h-4 w-4 text-primary"}),e.jsx(U,{children:m.title}),e.jsx(M,{className:"mb-4",children:m.description}),e.jsx(w,{onClick:a,size:"sm",className:"mt-2",children:"Autoriser l'accÃ¨s"})]})}function Oe({onCapture:c,onCancel:s,initialPhoto:u}){const{videoRef:h,isActive:g,error:i,startCamera:o,stopCamera:j,capturePhoto:m,hasPermission:p,requestPermission:v}=De(),[a,t]=l.useState(u||null),[r,f]=l.useState(!1);l.useEffect(()=>{p&&!g&&!a&&o()},[p,g,a]),l.useEffect(()=>()=>{j()},[]);const d=()=>{const x=m();x&&(t(x),f(!0),j())},y=()=>{t(null),f(!1),o()},n=()=>{a&&c(a)};return p?i?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-destructive/10 rounded-lg border border-destructive/20",children:e.jsx("p",{className:"text-sm text-destructive",children:i.message})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{variant:"outline",onClick:s,className:"flex-1",children:"Annuler"}),e.jsx(w,{onClick:o,className:"flex-1",children:"RÃ©essayer"})]})]}):e.jsx("div",{className:"space-y-4",children:r&&a?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative rounded-lg overflow-hidden border-2 border-primary",children:e.jsx("img",{src:a,alt:"Captured",className:"w-full h-64 object-cover"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",onClick:y,className:"flex-1",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Reprendre"]}),e.jsxs(w,{onClick:n,className:"flex-1",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Confirmer"]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative rounded-lg overflow-hidden border-2 border-primary bg-black",children:[e.jsx("video",{ref:h,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-64 object-cover"}),!g&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:e.jsxs(w,{onClick:o,size:"lg",children:[e.jsx(k,{className:"h-5 w-5 mr-2"}),"DÃ©marrer la camÃ©ra"]})})]}),g&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",onClick:s,className:"flex-1",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Annuler"]}),e.jsxs(w,{onClick:d,className:"flex-1",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Capturer"]})]})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(Fe,{type:"camera",onGranted:()=>v()}),e.jsx("div",{className:"flex gap-2",children:e.jsx(w,{variant:"outline",onClick:s,className:"flex-1",children:"Annuler"})})]})}function Ve(c={}){const{enableHighAccuracy:s=!0,timeout:u=1e4,maximumAge:h=0,watch:g=!1}=c,[i,o]=l.useState({latitude:null,longitude:null,accuracy:null,error:null,loading:!1}),j=l.useCallback(a=>{o({latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy,error:null,loading:!1})},[]),m=l.useCallback(a=>{o(t=>({...t,error:a,loading:!1}))},[]),p=l.useCallback(()=>{if(!navigator.geolocation){o(a=>({...a,error:{code:0,message:"La gÃ©olocalisation n'est pas supportÃ©e par ce navigateur",PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2,TIMEOUT:3},loading:!1}));return}o(a=>({...a,loading:!0,error:null})),navigator.geolocation.getCurrentPosition(j,m,{enableHighAccuracy:s,timeout:u,maximumAge:h})},[s,u,h,j,m]);l.useEffect(()=>{if(g){if(!navigator.geolocation){m({code:0,message:"La gÃ©olocalisation n'est pas supportÃ©e par ce navigateur",PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2,TIMEOUT:3});return}o(t=>({...t,loading:!0}));const a=navigator.geolocation.watchPosition(j,m,{enableHighAccuracy:s,timeout:u,maximumAge:h});return()=>{navigator.geolocation.clearWatch(a)}}},[g,s,u,h,j,m]);const v=l.useCallback(()=>{o({latitude:null,longitude:null,accuracy:null,error:null,loading:!1})},[]);return{...i,getCurrentPosition:p,clearWatch:v}}function qe({open:c,onOpenChange:s,onSubmit:u}){const[h,g]=l.useState(!1),[i,o]=l.useState({}),[j,m]=l.useState(!1),[p,v]=l.useState(null),{latitude:a,longitude:t,getCurrentPosition:r,loading:f}=Ve(),[d,y]=l.useState(null),[n,x]=l.useState({tag_number:"",sex:"male",breed:"",birth_date:"",status:"active",notes:"",initial_weight:""});l.useEffect(()=>{c&&!d&&!f&&r()},[c]),l.useEffect(()=>{a&&t&&y({lat:a,lng:t})},[a,t]);const N=async b=>{b.preventDefault(),o({}),g(!0);try{const q=he.safeParse({tag_number:n.tag_number,sex:n.sex,breed:n.breed||null,birth_date:n.birth_date||null,status:n.status,notes:n.notes||null,initial_weight:n.initial_weight});if(!q.success){const J={};q.error.errors.forEach(z=>{z.path[0]&&(J[z.path[0].toString()]=z.message)}),o(J),g(!1),C.error("Veuillez corriger les erreurs dans le formulaire");return}const se={tag_number:X(n.tag_number),sex:n.sex,breed:n.breed?X(n.breed):null,birth_date:n.birth_date||null,status:n.status,notes:me(n.notes),weight_history:n.initial_weight?[{date:new Date().toISOString(),weight:parseFloat(n.initial_weight)}]:[],...p&&{photo_url:p},...d&&{location:{latitude:d.lat,longitude:d.lng}}},{error:te}=await u(se);g(!1),te?Z():(x({tag_number:"",sex:"male",breed:"",birth_date:"",status:"active",notes:"",initial_weight:""}),v(null),y(null),m(!1),o({}),s(!1),ye(),C.success("Porc ajoutÃ© avec succÃ¨s !"))}catch{g(!1),Z(),C.error("Une erreur est survenue lors de l'ajout du porc")}},A=e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[Object.keys(i).length>0&&e.jsxs(R,{variant:"destructive",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx(M,{children:"Veuillez corriger les erreurs dans le formulaire"})]}),e.jsxs(Ce,{defaultValue:"info",className:"w-full",children:[e.jsxs(Se,{className:"grid w-full grid-cols-3",children:[e.jsx(B,{value:"info",children:"Informations"}),e.jsx(B,{value:"photo",children:"Photo"}),e.jsx(B,{value:"location",children:"Localisation"})]}),e.jsx(W,{value:"photo",className:"space-y-4",children:j?e.jsx(Oe,{onCapture:b=>{v(b),m(!1),C.success("Photo capturÃ©e avec succÃ¨s !")},onCancel:()=>m(!1),initialPhoto:p}):e.jsx("div",{className:"space-y-4",children:p?e.jsxs("div",{className:"relative rounded-lg overflow-hidden border-2 border-primary",children:[e.jsx("img",{src:p,alt:"Porc",className:"w-full h-48 object-cover"}),e.jsx(w,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>v(null),children:e.jsx(G,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"border-2 border-dashed border-muted rounded-lg p-8 text-center",children:[e.jsx(k,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Aucune photo ajoutÃ©e"}),e.jsxs(w,{type:"button",variant:"outline",onClick:()=>m(!0),children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Prendre une photo"]})]})})}),e.jsx(W,{value:"location",className:"space-y-4",children:e.jsx("div",{className:"space-y-4",children:d?e.jsxs("div",{className:"p-4 bg-primary/10 rounded-lg border border-primary/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(V,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Localisation enregistrÃ©e"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Latitude: ",d.lat.toFixed(6)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Longitude: ",d.lng.toFixed(6)]}),e.jsx(w,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>{y(null),r()},children:"Actualiser"})]}):e.jsxs("div",{className:"border-2 border-dashed border-muted rounded-lg p-8 text-center",children:[e.jsx(V,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:f?"RÃ©cupÃ©ration de la localisation...":"Aucune localisation enregistrÃ©e"}),!f&&e.jsxs(w,{type:"button",variant:"outline",onClick:r,children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Obtenir la localisation"]})]})})}),e.jsxs(W,{value:"info",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"tag_number",children:"NumÃ©ro d'identification *"}),e.jsx(L,{id:"tag_number",placeholder:"Ex: 001",value:n.tag_number,onChange:b=>{x({...n,tag_number:b.target.value}),i.tag_number&&o({...i,tag_number:""})},required:!0,className:i.tag_number?"border-destructive":""}),i.tag_number&&e.jsx("p",{className:"text-sm text-destructive",children:i.tag_number})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"sex",children:"Sexe *"}),e.jsxs(D,{value:n.sex,onValueChange:b=>x({...n,sex:b}),children:[e.jsx(T,{children:e.jsx(F,{})}),e.jsxs(O,{children:[e.jsx(_,{value:"male",children:"MÃ¢le â™‚ï¸"}),e.jsx(_,{value:"female",children:"Femelle â™€ï¸"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"breed",children:"Race"}),e.jsxs(D,{value:n.breed,onValueChange:b=>x({...n,breed:b}),children:[e.jsx(T,{children:e.jsx(F,{placeholder:"SÃ©lectionner"})}),e.jsx(O,{children:we.map(b=>e.jsx(_,{value:b,children:b},b))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"birth_date",children:"Date de naissance"}),e.jsx(L,{id:"birth_date",type:"date",value:n.birth_date,onChange:b=>x({...n,birth_date:b.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"status",children:"Statut"}),e.jsxs(D,{value:n.status,onValueChange:b=>x({...n,status:b}),children:[e.jsx(T,{children:e.jsx(F,{})}),e.jsxs(O,{children:[e.jsx(_,{value:"active",children:"Actif"}),e.jsx(_,{value:"breeding",children:"Reproduction"}),e.jsx(_,{value:"sold",children:"Vendu"}),e.jsx(_,{value:"deceased",children:"DÃ©cÃ©dÃ©"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"initial_weight",children:"Poids initial (kg)"}),e.jsx(L,{id:"initial_weight",type:"number",step:"0.1",placeholder:"Ex: 15.5",value:n.initial_weight,onChange:b=>{x({...n,initial_weight:b.target.value}),i.initial_weight&&o({...i,initial_weight:""})},className:i.initial_weight?"border-destructive":"",min:"0",max:"500"}),i.initial_weight&&e.jsx("p",{className:"text-sm text-destructive",children:i.initial_weight})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"notes",children:"Notes"}),e.jsx(Ne,{id:"notes",placeholder:"Notes additionnelles...",value:n.notes,onChange:b=>{x({...n,notes:b.target.value}),i.notes&&o({...i,notes:""})},className:i.notes?"border-destructive":"",maxLength:1e3}),i.notes&&e.jsx("p",{className:"text-sm text-destructive",children:i.notes}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.notes.length,"/1000 caractÃ¨res"]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Annuler"}),e.jsxs(w,{type:"submit",disabled:h||!n.tag_number,children:[h&&e.jsx(de,{className:"mr-2 h-4 w-4 animate-spin"}),"Ajouter"]})]})]});return e.jsx(xe,{open:c,onOpenChange:s,children:e.jsxs(ge,{className:"sm:max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(fe,{children:[e.jsx(je,{children:"Ajouter un porc"}),e.jsx(ve,{children:"Remplissez les informations du nouveau porc"})]}),A]})})}function ze(){return e.jsxs(Q,{className:"overflow-hidden",children:[e.jsx("div",{className:"aspect-square relative bg-muted",children:e.jsx(P,{className:"w-full h-full"})}),e.jsxs(Y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(P,{className:"h-5 w-20"}),e.jsx(P,{className:"h-5 w-5 rounded-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"h-4 w-24"}),e.jsx(P,{className:"h-4 w-16"})]})]})]})}function Ue({count:c=10}){return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:Array.from({length:c}).map((s,u)=>e.jsx(ze,{},u))})}function ls(){const[c]=re();ae();const[s,u]=l.useState(""),[h,g]=l.useState("all"),[i,o]=l.useState(c.get("action")==="add"),{pigs:j,loading:m,addPig:p,refetch:v}=Me({status:h==="all"?void 0:h,search:s||void 0}),{isPulling:a}=Ee({onRefresh:async()=>{_e(),await v()}}),t=l.useMemo(()=>j,[j]);return e.jsxs("div",{className:`content-area space-y-6 transition-transform duration-300 ${a?"translate-y-2":""}`,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-foreground",children:"Mes Porcs"}),e.jsxs("p",{className:"text-muted-foreground",children:[j.length," porcs au total"]})]}),e.jsxs(w,{onClick:()=>o(!0),children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Ajouter un porc"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(L,{placeholder:"Rechercher par numÃ©ro...",value:s,onChange:r=>u(r.target.value),className:"pl-10 min-h-[44px]"})]}),e.jsxs(D,{value:h,onValueChange:r=>g(r),children:[e.jsxs(T,{className:"w-full sm:w-48",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),e.jsx(F,{placeholder:"Filtrer par statut"})]}),e.jsxs(O,{children:[e.jsx(_,{value:"all",children:"Tous les statuts"}),e.jsx(_,{value:"active",children:"Actif"}),e.jsx(_,{value:"breeding",children:"Reproduction"}),e.jsx(_,{value:"sold",children:"Vendu"}),e.jsx(_,{value:"deceased",children:"DÃ©cÃ©dÃ©"})]})]})]}),m?e.jsx(Ue,{count:10}):t.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ·"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Aucun porc trouvÃ©"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s?"Essayez une autre recherche":"Commencez par ajouter votre premier porc"}),!s&&e.jsxs(w,{onClick:()=>o(!0),children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Ajouter un porc"]})]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:t.map(r=>e.jsx(Re,{pig:r,onClick:()=>{hapticLight()}},r.id))}),e.jsx(qe,{open:i,onOpenChange:o,onSubmit:p})]})}export{ls as default};
